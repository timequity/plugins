# Урок 4: Хуки и автоматизация

**Время:** ~20 минут

## Цели урока

После этого урока ты будешь:
- Понимать что такое хуки и зачем они нужны
- Знать типы хуков и когда их использовать
- Создашь хук для автоматического форматирования
- Научишься автоматизировать рутинные задачи

---

## Что такое хуки?

**Хук** — это команда которая автоматически выполняется в определённый момент.

Пример: каждый раз когда Claude редактирует файл, автоматически запускать форматирование. Это хук!

```
Claude: [Edit файл]
  ↓
Хук: [Запускает prettier]
  ↓
Результат: файл отформатирован
```

---

## Типы хуков

| Тип | Когда срабатывает |
|-----|-------------------|
| `PreToolUse` | ДО использования инструмента |
| `PostToolUse` | ПОСЛЕ использования инструмента |
| `Notification` | При событиях (старт сессии и т.д.) |

### PreToolUse

Выполняется перед инструментом. Может:
- Добавить информацию в контекст
- Заблокировать действие (если вернёт error)

### PostToolUse

Выполняется после инструмента. Может:
- Обработать результат
- Запустить дополнительные команды

---

## Где настраиваются хуки

В файле `.claude/settings.json`:

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Edit",
        "hooks": [
          {
            "type": "command",
            "command": "prettier --write $CLAUDE_FILE_PATH"
          }
        ]
      }
    ]
  }
}
```

---

## Структура хука

```json
{
  "matcher": "Edit",          // Какой инструмент
  "hooks": [
    {
      "type": "command",      // Тип: command
      "command": "команда"    // Что выполнить
    }
  ]
}
```

### Matcher

Какой инструмент отслеживать:
- `"Edit"` — редактирование файлов
- `"Write"` — создание файлов
- `"Bash"` — выполнение команд
- `"*"` — любой инструмент

### Переменные окружения

| Переменная | Описание |
|------------|----------|
| `$CLAUDE_FILE_PATH` | Путь к файлу |
| `$CLAUDE_TOOL_NAME` | Имя инструмента |
| `$CLAUDE_TOOL_INPUT` | Входные данные (JSON) |

---

## Пример: Форматирование после редактирования

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Edit",
        "hooks": [
          {
            "type": "command",
            "command": "prettier --write \"$CLAUDE_FILE_PATH\" 2>/dev/null || true"
          }
        ]
      }
    ]
  }
}
```

**Что происходит:**
1. Claude редактирует файл
2. Хук запускает prettier
3. Файл автоматически форматируется

---

## Пример: Проверка перед коммитом

```json
{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_INPUT\" | grep -q 'git commit'; then npm test || exit 1; fi"
          }
        ]
      }
    ]
  }
}
```

**Что происходит:**
1. Claude хочет сделать git commit
2. Хук запускает тесты
3. Если тесты падают — коммит блокируется

---

## Блокировка действий

Если хук возвращает ненулевой exit code — действие блокируется:

```json
{
  "type": "command",
  "command": "exit 1"  // Блокирует действие
}
```

Используй для:
- Проверки перед опасными операциями
- Валидации входных данных
- Защиты критичных файлов

---

## Резюме

- Хуки = автоматические действия
- PreToolUse — до, PostToolUse — после
- Настраиваются в `.claude/settings.json`
- Могут блокировать действия (exit 1)

---

## Практика

**Задание:** Создай хук который показывает уведомление после создания файла.

**Требования:**
1. Тип: PostToolUse
2. Matcher: Write
3. Команда: `echo "Создан файл: $CLAUDE_FILE_PATH"`

**Шаги:**
1. Создай или отредактируй `.claude/settings.json`
2. Добавь секцию hooks
3. Настрой PostToolUse для Write

**Проверка:**
После создания попроси меня создать любой файл — должно появиться сообщение.

<details>
<summary>Подсказка</summary>

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write",
        "hooks": [
          {
            "type": "command",
            "command": "echo \"✓ Создан файл: $CLAUDE_FILE_PATH\""
          }
        ]
      }
    ]
  }
}
```

</details>

Когда закончишь, скажи "готово" и я проверю результат.
